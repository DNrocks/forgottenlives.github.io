<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echoes of Forgotten Lives</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #1e3c72, #2a5298);
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }

        .candle {
            cursor: pointer;
            font-size: 2rem;
            background: none;
            border: none;
            color: #fff;
        }

        .slider-container {
            position: relative;
            width: 80%;
        }

        .slider {
            width: 100%;
        }

        .slider-value {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
        }

        .questions-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            width: 80%;
        }

        .questions-container div {
            text-align: center;
        }

        .questions-container button {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background: #3b5998;
            color: #fff;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .questions-container button:hover {
            background: #1e3c72;
        }

        .questions-container button.active {
            background: #ff9800; /* Highlight color for selected button */
            color: #000; /* Text color for visibility */
        }

        .hidden {
            display: none;
        }

        textarea {
            width: 80%;
            padding: 10px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="screen1" class="container">
        <h1>Recall a Forgotten Memory</h1>
        <p>Think about something lost amidst life: a book, friend, toy, goal, or anything else. Let it come to mind.</p>
        <button class="candle" onclick="nextScreen(2)">ðŸ”¥</button>
    </div>

    <div id="screen2" class="container hidden">
        <h1>When Did This Happen?</h1>
        <p>Move the slider to indicate the age when this forgotten thing occurred.</p>
        <div class="slider-container">
            <span id="sliderValue" class="slider-value">25</span>
            <input type="range" id="ageSlider" class="slider" min="0" max="100" step="1" value="25" oninput="updateSliderValue()">
        </div>
        <button class="candle" onclick="nextScreen(3)">ðŸ”¥</button>
    </div>

    <div id="screen3" class="container hidden">
        <h1>Tell Us About the Memory</h1>
        <p>Answer the following questions about your memory:</p>
        <div class="questions-container">
            <div>
                <p>Is it a happy memory?</p>
                <button onclick="selectOption(this, 'memoryEmotion', 'Happy')">Yes</button>
                <button onclick="selectOption(this, 'memoryEmotion', 'Not Happy')">No</button>
            </div>
            <div>
                <p>Are you satisfied with the outcome?</p>
                <button onclick="selectOption(this, 'satisfaction', 'Satisfied')">Yes</button>
                <button onclick="selectOption(this, 'satisfaction', 'Not Satisfied')">No</button>
            </div>
            <div>
                <p>Do you wish it was still a part of your life?</p>
                <button onclick="selectOption(this, 'desire', 'Yes')">Yes</button>
                <button onclick="selectOption(this, 'desire', 'No')">No</button>
            </div>
        </div>
        <button class="candle" onclick="nextScreen(4)">ðŸ”¥</button>
    </div>

    <div id="screen4" class="container hidden">
        <h1>Describe Your Memory</h1>
        <p>Share as much detail as you can, including trivial aspects of the memory.</p>
        <textarea id="memoryDescription" rows="6" cols="50" placeholder="Write about your memory here..."></textarea>
        <button class="candle" onclick="generateStory()">ðŸ”¥</button>
    </div>

    <script>
        const userInputs = {
            age: null,
            memoryEmotion: null,
            satisfaction: null,
            desire: null,
            memoryDescription: null
        };

        function nextScreen(screenNumber) {
            const screens = document.querySelectorAll('.container');
            screens.forEach(screen => screen.classList.add('hidden'));
            document.getElementById(`screen${screenNumber}`).classList.remove('hidden');
        }

        function updateSliderValue() {
            const slider = document.getElementById('ageSlider');
            const sliderValue = document.getElementById('sliderValue');
            sliderValue.textContent = slider.value;
            const sliderContainer = slider.parentElement;
            const sliderWidth = slider.offsetWidth;
            const valuePosition = (slider.value - slider.min) / (slider.max - slider.min) * sliderWidth;
            sliderValue.style.left = `${valuePosition}px`;
            userInputs.age = slider.value;
        }

        function selectOption(button, key, value) {
            // Remove "active" class from all sibling buttons
            const buttons = button.parentElement.querySelectorAll('button');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Add "active" class to the clicked button
            button.classList.add('active');

            // Save the value
            userInputs[key] = value;
            console.log(`Saved ${key}: ${value}`);
        }

        async function generateStory() {
            userInputs.memoryDescription = document.getElementById('memoryDescription').value;
        
            const requestBody = {
                prompt: {
                        text: `
                            Based on the following inputs, create a highly emotional and immersive narrative:
                            Age: ${userInputs.age}
                            Memory Emotion: ${userInputs.memoryEmotion}
                            Satisfaction with Outcome: ${userInputs.satisfaction}
                            Desire to Reconnect: ${userInputs.desire}
                            Description: ${userInputs.memoryDescription}
                                
                                                    Start with a gentle, nostalgic introduction that brings the user into the context of their memory.
                                Create a utopian world where the memory has been preserved or revived in a way that aligns with the user's emotional state and desires.
                                Include symbolic elements from the userâ€™s description, even seemingly trivial ones, to add depth and connection.
                                Use poetic and evocative language to engage the userâ€™s senses and emotions.
                                Conclude with a powerful message or insight that leaves the user feeling hopeful, reflective, or at peace with their memory.
                                Example Style:
                                
                                If the memory is about a lost friend: Imagine a world where the user stumbles upon a timeless garden where every forgotten connection blossoms anew.
                                If the memory is about a toy: Picture a fantastical land where the toy transforms into a companion guiding the user through adventures they always dreamed of.
                                Output Format:
                                
                                Title: A short, impactful title for the story.
                                Narrative: A 2-3 paragraph story that fulfills the guidelines.
                                Be creative, sensitive, and ensure the story feels deeply personal and meaningful to the user."
                                
                                
                                Also in the code, instead of the two questions "Is it a sad memory" and "IS it a happy memory", just edit into one question - "Is it a happy memory?" with choices yes and no.  
                        `
                }
            };
        
            const apiKey = 'AIzaSyDeltszerqnjtH0heRUpTmG0mvwsA4Fg5o'; // Replace with your API key
            const url = `https://generativelanguage.googleapis.com/v1beta2/models/text-bison-001:generateText?key=${apiKey}`;
        
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody),
                });
        
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
        
                const rawResponse = await response.text();
                console.log("Raw Response:", rawResponse);
                const data = JSON.parse(rawResponse);
        
                const story = data.generatedText || 'No story generated.';
                alert(`Generated Story:\n\n${story}`);
            } catch (error) {
                console.error("Error:", error);
        
                const fallbackStory = `
                    It seems there was an issue generating your story. Hereâ€™s a placeholder story:
                    "In a quiet corner of your past, this memory lives on, vivid and full of meaning. Even though it's been forgotten, it still shapes who you are today."
                `;
                alert(`Fallback Story:\n\n${fallbackStory}`);
            }
        }



    </script>
</body>
</html>
